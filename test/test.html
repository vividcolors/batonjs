<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test</title>
  </head>
  <body>
    <script type="module">
      import {diff} from '../baton.js'

      const test1 = () => {
        const doIt = (name, newKeys, oldKeys) => {
          const evs = diff(newKeys, oldKeys)
          console.log(name, newKeys, oldKeys, evs)
        }
        const oldKeys = ["a", "b", "c", "d"]
        doIt('remove first', ["b", "c", "d"], oldKeys)
        doIt('remove middle', ["a", "c", "d"], oldKeys)
        doIt('remove last', ["a", "b", "c"], oldKeys)
        doIt('insert first', ["e", "a", "b", "c", "d"], oldKeys)
        doIt('insert middle', ["a", "b", "c", "e", "d"], oldKeys)
        doIt('insert last', ["a", "b", "c", "d", "e"], oldKeys)
        doIt('move down first to middle', ["b", "c", "a", "d"], oldKeys)
        doIt('move down first to last', ["b", "c", "d", "a"], oldKeys)
        doIt('move down middle to middle', ["a", "c", "b", "d"], oldKeys)
        doIt('move down middle to last', ["a", "c", "d", "b"], oldKeys)
        doIt('move up middle to first', ["c", "a", "b", "d"], oldKeys)
        doIt('move up middle to middle', ["a", "c", "b", "d"], oldKeys)
        doIt('move up last to first', ["d", "a", "b", "c"], oldKeys)
        doIt(' move up last to middle', ["a", "d", "b", "c"], oldKeys)
      }
      const test2 = () => {
        const doIt = (name, newKeys, oldKeys) => {
          const evs = diff(newKeys, oldKeys)
          const keys = [...oldKeys]
          for (let ev of evs) {
            switch (ev.type) {
              case 'insert': {
                const i = ev.afterKey ? (keys.indexOf(ev.afterKey) + 1) : 0
                keys.splice(i, 0, ev.key)
                break
              }
              case 'remove': {
                const i = keys.indexOf(ev.key)
                keys.splice(i, 1)
                break
              }
              case 'move': {
                const i = keys.indexOf(ev.key)
                keys.splice(i, 1)
                const j = ev.afterKey ? (keys.indexOf(ev.afterKey) + 1) : 0
                keys.splice(j, 0, ev.key)
              }
            }
          }
          for (let i = 0; i < keys.length; i++) {
            if (keys[i] !== newKeys[i]) {
              console.log(name, newKeys, oldKeys, evs, keys)
              return
            }
          }
        }
        const oldKeys = ["a", "b", "c", "d"]
        doIt("1", ["d", "c"], oldKeys)
        doIt("2", ["e", "a", "f"], oldKeys)
        doIt("3", ["a", "d", "c", "b"], oldKeys)
        doIt("4", ["b", "d", "a", "c"], oldKeys)
      }

      test2()
    </script>
  </body>
</html>