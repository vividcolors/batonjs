<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ライブサンプル</title>
  </head>
  <body class="force-mobile-layout">
    <nav class="container-fluid" id="header"></nav>
    
    <main class="container-fluid">
      <aside id="sidebar"></aside>
      <div role="document">
        <select id="selector">
          <option value="1">1: Simple counter</option>
          <option value="2">2: Internalizing event handler</option>
          <option value="3">3: Css-transition</option>
          <option value="4">4: Using class-* property, style-* property</option>
          <option value="5">5: Nested selectors</option>
          <option value="6">6: Declaration as function</option>
          <option value="7">7: Controlled inputs</option>
          <option value="8">8: Uncontrolled inputs</option>
          <option value="9">9: Using web components</option>
          <option value="10">10: Asynchronous event handler</option>
          <option value="11">11: Handling SVG</option>
          <option value="12">12: Multiple instances</option>
          <option value="13">13: Creating web components</option>
          <option value="14">14: Practical -- dynamic content, bootstrap-css integration, rest api</option>
          <option value="15">15: jQuery's slideUp/Down</option>
          <option value="16">16: Scroll Animation</option>
          <option value="17">17: Dropdown</option>
          <option value="18">18: Insert/Remove child</option>
          <option value="19">19: Insert/Remove child with CSS Transition</option>
          <option value="20">20: Carousel Slider</option>
          <option value="21">21: Sortable ToDo List by Sortablejs</option>
          <option value="22">22: Loading batonjs in UMD format</option>
          <option value="23">23: CSS Transition at initialization</option>
        </select>
        </label>
        <div class="grid" id="the-grid">
          <div>
            <iframe id="result" width="600" height="600"></iframe>
          </div>
          <div>
            <pre class="line-numbers" id="src-wrap"><code class="language-html" id="src"></code></pre>
          </div>
        </div>
        <footer id="footer"></footer>
      </div>
    </main>
    <script>
      const result = document.getElementById('result')
      const selector = document.getElementById('selector')
      const src = document.getElementById('src')
      selector.addEventListener('change', (ev) => {
        const url = new URL(window.location)
        url.searchParams.set('no', ev.target.value)
        history.pushState(ev.target.value, '', url)
        load(ev.target.value)
      })
      const adjust = () => {
        const grid = document.getElementById('the-grid')
        const dh = document.getElementById('footer').getBoundingClientRect().bottom + (window.pageYOffset || document.documentElement.scrollTop)
        const gr = grid.getBoundingClientRect()
        const wh = window.innerHeight
        const gh = gr.height
        const rh = dh - gr.height
        const h = wh - rh
        grid.style.setProperty('--height', h + "px")
        result.removeAttribute("width")
        result.removeAttribute("height")

        const url = new URL(window.location)
        let no = url.searchParams.get('no')
        if (! no) no = "1"
        selector.querySelector("[value='" + no + "']").selected = true
        load(no)
      }
      const load = (no) => {
        const url = `../samples/sample${no}.html`
        result.src = url
        fetch(url)
        .then(res => res.text())
        .then(txt => {
          src.textContent = txt
          if (window.Prism) {
            window.Prism.highlightAll()
          }
        })
      }
      adjust()
    </script>
  </body>
</html>